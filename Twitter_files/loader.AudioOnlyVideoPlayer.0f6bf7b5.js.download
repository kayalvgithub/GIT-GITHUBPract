(window.webpackJsonp=window.webpackJsonp||[]).push([[166],{"Pc/x":function(e,t,i){"use strict";i.d(t,"a",(function(){return S}));i("849X");var n=i("CEs6");class r extends Error{constructor(e,t,i){super(`${r.displayName}: ${e} HTTP-${t} message: ${i}`),this.url=e,this.status=t}}r.displayName="ProxseeApiError";var a=i("epkG"),o=i("SrIh"),s=i("RqPI");let c,u=0;const l="X-Idempotence",p={["X-Periscope-User-Agent"]:"Twitter/m5",["X-Attempt"]:1};function h(){const e=Date.now();return u=e<=u?u+1:e,Object.assign({},p,{[l]:u,"content-type":"application/json"})}const d="m5-proxsee-login-a2011357b73e",y={},m={host:"https://proxsee.pscp.tv",errorFilter:function(e,t){return t(e).then((t=>{return t.status&&((i=t.status)<200||i>399)?Promise.reject(function(e,t){const{uri:i}=e,{status:a}=t,o=Object(n.a)(t);return new r(i,a,o.msg)}(e,t)):t;var i}))}};const f=Object.freeze({SelfHarm:"SELF_HARM",Violence:"VIOLENCE",SexualContent:"SEXUAL_CONTENT",ChildSafety:"CSE",PrivateInformation:"PRIVATE_INFO",AbusiveBehavior:"HARASSMENT"}),g=new class{constructor(e=y){this.reportSpaceFor={SelfHarm:e=>this._reportSpace({abuse_type:f.SelfHarm,...e}),Violence:e=>this._reportSpace({abuse_type:f.Violence,...e}),SexualContent:e=>this._reportSpace({abuse_type:f.SexualContent,...e}),ChildSafety:e=>this._reportSpace({abuse_type:f.ChildSafety,...e}),PrivateInformation:e=>this._reportSpace({abuse_type:f.PrivateInformation,...e}),AbusiveBehavior:e=>this._reportSpace({abuse_type:f.AbusiveBehavior,...e})};const{httpConfig:t}=e;this.client=new a.a({...m,...t}),this._authToken=void 0,this._authPromise=null}init(e){c=e}initialized(){return!!c}isLoggedIn(){return!!this._authToken}isTwitterAuthenticated(){if(!this.initialized())return!1;const e=c.store.getState();return Object(s.m)(e)}authToken(){return this._authToken}dispatch(e){return this.initialized()?this.client.dispatch(e).then(n.a):Promise.reject(new Error("[ProxseeApi] config not initialized"))}post(e,t,i={}){const{params:n}=i,r=Object.assign(h(),i.headers),a=JSON.stringify({...t,cookie:this._authToken}),o="Twitter"===this._authUserType?`twitter/${e}`:e;return this.dispatch({method:"POST",path:`/api/v2/${o}`,headers:r,params:n,data:a})}login(){return this._authPromise?this._authPromise:this.initialized()?this.isTwitterAuthenticated()?this.isLoggedIn()?Promise.resolve():(this._authPromise=c.api.Auth.authenticatePeriscope().then((e=>this.loginTwitterToken(e.token))).then((e=>{if(!e)throw new Error("[ProxseeApi] invalid loginTwitterToken response");this._authToken=e.cookie,this._authUserType=e.type})).catch((e=>{const t={err:e};Object(o.a)("[ProxseeApi] failed to login",{extra:t})})).then((()=>{this._authPromise=null})),this._authPromise):Promise.resolve():Promise.reject(new Error("[ProxseeApi] config not initialized"))}loginTwitterToken(e){const t={jwt:e,vendor_id:d,create_user:!1,direct:!0};return this.post("loginTwitterToken",t)}publicPath(e){return this.isLoggedIn()?e:`${e}Public`}accessChat(e){return this.login().then((()=>this.post(this.publicPath("accessChat"),{chat_token:e})))}getChatHistory(e,t={}){return this.login().then((()=>{const{params:i}=t,n=Object.assign(h(),t.headers),r=JSON.stringify({access_token:e.access_token,cursor:e.cursor,limit:1e3,since:null});return this.dispatch({method:"POST",host:e.host,path:e.path,headers:n,params:i,data:r})}))}trackAudiospaceClientEvent(e){return e.length?this.login().then((()=>this.post(this.publicPath("trackAudiospaceClientEvent"),{time:Date.now(),log:e}).catch((e=>{Object(o.a)("[ProxseeApi] failed to scribe events",{extra:{err:e}})})))):Promise.resolve()}_reportSpace(e){return this.login().then((()=>this.post("markAbuse",e).catch((e=>{Object(o.a)("[ProxseeApi] failed to report space",{extra:{err:e}})}))))}};var b=i("G6rE");let P;const _=new Error("[AudioModule] config not initialized");var S=new class{constructor(){this.proxsee=g}init(e){P=e,g.init(P)}initialized(){return!!P}loggedInUser(){if(this.initialized()){const e=P.store.getState();return b.e.selectLoggedInUser(e)}}audioSpace(e){return P?P.api.AudioSpaces.byId(e):Promise.reject(_)}subscribeToScheduledSpace(e){return P?P.api.AudioSpaces.subscribeToScheduledSpaceById(e):Promise.reject(_)}unsubscribeFromScheduledSpace(e){return P?P.api.AudioSpaces.unsubscribeFromScheduledSpaceById(e):Promise.reject(_)}searchAudioSpace(e,t){return P?P.api.AudioSpaces.search(e,t):Promise.reject(_)}}},u2Vg:function(e,t,i){"use strict";i.r(t),i.d(t,"__DANGEROUS_IMPORT_VIDEOPLAYER_BASE__",(function(){return A})),i.d(t,"__DANGEROUS_IMPORT__",(function(){return T}));i("kYxP");var n=i("ERkP"),r=i.n(n),a=i("v6aA"),o=i("rxPX");const s=()=>(e,t,{api:i})=>i.getHttpClient();var c=Object(o.a)().propsFromActions((()=>({getTwitterAuthedHttpClient:s}))).withAnalytics(),u=i("Pc/x"),l=i("gOg7");var p=i("epkG"),h=i("88qn"),d=i("fs1G"),y=i("mf9H"),m=i("lklz"),f=i("MWbm"),g=i("HT/6"),b=i("Zl35"),P=i("rHpw");function _(e){const{featureSwitches:t}=r.a.useContext(a.a),{broadcastId:i,isLive:n,media:o,mediaKey:s,onEnded:c,onPlayerApi:p,onPlayerState:f,requestedTimecode:b}=e,[P,_]=r.a.useState(null),A=r.a.useRef({playbackCoordinationEmitter:null,previousPlayerState:null}),T=o||i&&s;if(r.a.useEffect((()=>{null===P&&T&&Object(h.a)({showControls:!1,source:{}},t).then((e=>_((()=>e))))}),[P,T,t]),r.a.useEffect((()=>function(){const{playbackCoordinationEmitter:e}=A.current;e&&e.unregister()}),[]),null===P||!T)return null;const w={analytics:function(e,t){const i={scribeContext:{...e.analytics.contextualScribeNamespace},enableShortFormCompleteLogging:t.isTrue("responsive_web_video_pcomplete_enabled"),periscopeAuthToken:u.a.proxsee.authToken()},n={log:t=>{const{category:i,data:n,namespace:r}=t;null!=r&&r.action&&e.analytics.scribe({...r,data:{...n,_category_:i}})}};return new l.a(n,{log:()=>{}},e.getTwitterAuthedHttpClient(),i)}(e,t),basePlayerClass:P,httpClient:k,onApiReady:function(t){var n;t.play(),"function"==typeof p&&p(t);const r=null==o||null==(n=o.video_info)?void 0:n.duration_millis;"number"==typeof r&&"number"==typeof b&&t.scrubToFraction(b/r);const a=e.disablePlaybackCoordination?d.a:()=>t.pause(),c=i&&s?g.a.SPACE:g.a.NORMAL;A.current.playbackCoordinationEmitter=function(e,t){const i={onAutoPlayRequest:()=>{},onPauseRequest:e,canAutoplay:!1,isLooping:!1,playbackPriority:t};return y.b.register(i)}(a,c)},onStateUpdate:function(e,t){"function"==typeof f&&f(e,t),function(e){const t=v(e);e.isPlaying&&t&&t.durationMs===t.currentTimeMs&&"function"==typeof c&&(c(),A.current.playbackCoordinationEmitter&&A.current.playbackCoordinationEmitter.signalPlaybackFinish())}(e),function(e){const{playbackCoordinationEmitter:t,previousPlayerState:i}=A.current,n=null===i,r=null==i?void 0:i.isPlaying,a=e.isPlaying,o=!n&&r&&!a;!n&&r||!a?o&&t&&t.signalPause():t&&t.signalPlay()}(e),A.current.previousPlayerState=e},twitterAuthedHttpClient:e.getTwitterAuthedHttpClient()};if(i&&s){const e={...w,configType:"static",contentId:s,contentType:"broadcast",variants:[],videoId:m.b.forAudioSpace(i,s,n)};return r.a.createElement(S,{key:i,playerConfig:e})}if(o){const e={...w,configType:"static",contentId:o.id_str,loop:!1,contentType:"media_entity",durationMs:o.video_info.duration_millis,variants:o.video_info.variants.map((({bitrate:e,content_type:t,url:i})=>({type:t,src:i})))};return r.a.createElement(S,{key:o.id_str,playerConfig:e})}return null}function S({playerConfig:e}){return r.a.createElement(f.a,{style:w.displayNone},r.a.createElement(b.b,e))}const A=_,T=c(_),v=e=>e&&e.tracks[e.currentTrackId],k=new p.a({}),w=P.a.create((e=>({displayNone:{display:"none"}})))}}]);
//# sourceMappingURL=https://ton.local.twitter.com/responsive-web-internal/sourcemaps/client-web/loader.AudioOnlyVideoPlayer.0f6bf7b5.js.map